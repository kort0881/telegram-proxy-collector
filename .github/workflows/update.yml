name: Update Proxy List

on:
  schedule:
    - cron: '0 */4 * * *'  # –ö–∞–∂–¥—ã–µ 4 —á–∞—Å–∞
  workflow_dispatch:      # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    - name: Install dependencies
      run: |
        pip install requests

    - name: Run scraper script
      run: python main.py

    - name: Commit and push changes
      run: |
        git config --global user.name 'GitHub Actions'
        git config --global user.email 'actions@github.com'
        
        # –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã
        git add proxy_ru.txt proxy_eu.txt proxy_all.txt
        
        # –ï—Å–ª–∏ —Å—Ç–∞—Ä—ã–π —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, —É–¥–∞–ª—è–µ–º –µ–≥–æ
        if [ -f "proxy_list.txt" ]; then
          git rm proxy_list.txt || true
        fi
        
        # –ö–æ–º–º–∏—Ç–∏–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
        git diff --quiet && git diff --staged --quiet || (git commit -m "üîÑ Auto-update: RU/EU proxy lists $(date +'%Y-%m-%d %H:%M UTC')" && git push)

